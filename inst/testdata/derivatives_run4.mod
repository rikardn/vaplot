$PROBLEM    WARFARIN PKPD
$DATA      warfarin-sim IGNORE=@
$INPUT      ID WT AGE SEX TIME AMT RATX DVID DV MDV EVID
$THETA  (0.01,0.134,1) ; POPCL L/h/70kg
 (0.01,8.09,20) ; POPV L/70kg
 (0.01,0.6,24) ; POPKA h
 (0.01,96.5,200) ; POPE0
 (-1000000,-74.3,0) ; POPEMAX
 (0.01,0.219,100) ; POPC50
$OMEGA  0.09  ;      PPVCL
 0.09  ;       PPVV
 0.9  ;      PPVKA
 0.001  ;      PPVE0
 0.01  ;    PPVEMAX
 0.5  ;     PPVC50
$SIGMA  0.00697  ;      RUVCV
$SIGMA  0.0824  ; RUVSD mg/L
$SIGMA  30  ;      RUVFX
$SUBROUTINE ADVAN2 TRAN2
$PK


   FSZV=WT/70
   FSZCL=FSZV**0.75

   CL=FSZCL*THETA(1)*EXP(ETA(1))
   V=FSZV*THETA(2)*EXP(ETA(2))
    KA=THETA(3)*EXP(ETA(3))



   S2=V

   E0=THETA(4)*EXP(ETA(4))
   EMAX=THETA(5)*EXP(ETA(5))
   C50=(1-SEX*0.5)*THETA(6)*EXP(ETA(6))


$ERROR

   CP=F
   PCA=E0 + EMAX*CP/(C50+CP)
   IF (DVID.LE.1) THEN
    IPRED = CP
      Y=CP*(1+ERR(1)) + ERR(2)
   ENDIF
   IF (DVID.EQ.2) THEN
   IPRED = PCA
      Y=PCA + ERR(3)
   ENDIF


D_EPSETA1_1 = 0
D_EPSETA1_2 = 0
D_EPSETA1_3 = 0
D_EPSETA1_4 = 0
D_EPSETA1_5 = 0
D_EPSETA1_6 = 0
D_EPSETA2_1 = 0
D_EPSETA2_2 = 0
D_EPSETA2_3 = 0
D_EPSETA2_4 = 0
D_EPSETA2_5 = 0
D_EPSETA2_6 = 0
D_EPSETA3_1 = 0
D_EPSETA3_2 = 0
D_EPSETA3_3 = 0
D_EPSETA3_4 = 0
D_EPSETA3_5 = 0
D_EPSETA3_6 = 0
"LAST
"D_EPSETA1_1=HH(1,2)
"D_EPSETA1_2=HH(1,3)
"D_EPSETA1_3=HH(1,4)
"D_EPSETA1_4=HH(1,5)
"D_EPSETA1_5=HH(1,6)
"D_EPSETA1_6=HH(1,7)
"D_EPSETA2_1=HH(2,2)
"D_EPSETA2_2=HH(2,3)
"D_EPSETA2_3=HH(2,4)
"D_EPSETA2_4=HH(2,5)
"D_EPSETA2_5=HH(2,6)
"D_EPSETA2_6=HH(2,7)
"D_EPSETA3_1=HH(3,2)
"D_EPSETA3_2=HH(3,3)
"D_EPSETA3_3=HH(3,4)
"D_EPSETA3_4=HH(3,5)
"D_EPSETA3_5=HH(3,6)
"D_EPSETA3_6=HH(3,7)
$ESTIMATION METHOD=COND INTERACTION PRINT=1 NOABORT MAX=0
$TABLE      ID TIME WT AGE SEX AMT RATX DVID DV MDV EVID NOAPPEND
            ONEHEADER NOPRINT FILE=sdtab4.mod
;; ETAS and covariates are added in the table manually (derivatives_run4.tab)

$TABLE      ID TIME WT AGE SEX AMT RATX DVID DV MDV EVID
            ETA1 ETA2 ETA3 ETA4 ETA5 ETA6
            H011 H021 H031 G011 G021 G031 G041 G051 G061 D_EPSETA1_1
            D_EPSETA1_2 D_EPSETA1_3 D_EPSETA1_4 D_EPSETA1_5
            D_EPSETA1_6 D_EPSETA2_1 D_EPSETA2_2 D_EPSETA2_3
            D_EPSETA2_4 D_EPSETA2_5 D_EPSETA2_6 D_EPSETA3_1
            D_EPSETA3_2 D_EPSETA3_3 D_EPSETA3_4 D_EPSETA3_5
            D_EPSETA3_6 NOPRINT NOAPPEND ONEHEADER
            FILE=derivatives_run4.tab FORMAT=s1PE15.8

